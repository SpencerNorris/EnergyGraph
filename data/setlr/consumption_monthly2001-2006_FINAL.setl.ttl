@prefix prov:          <http://www.w3.org/ns/prov#> .
@prefix dcat:          <http://www.w3.org/ns/dcat#> .
@prefix dcterms:       <http://purl.org/dc/terms/> .
@prefix void:          <http://rdfs.org/ns/void#> .
@prefix setl:          <http://purl.org/twc/vocab/setl/> .
@prefix csvw:          <http://www.w3.org/ns/csvw#> .
@prefix pv:            <http://purl.org/net/provenance/ns#> .
@prefix eg:	       <http://semanticweb.org/energysources/> .
@prefix obo: 	       <http://ecoinformatics.org/oboe/oboe.1.0/oboe-core.owl#> .
@prefix xsd: 	       <http://www.w3.org/2001/XMLSchema#> .
@prefix :              <http://example.com/setl/> .

:table a csvw:Table, setl:Table;
  csvw:delimiter "," ;
  prov:wasGeneratedBy [
    a setl:Extract ;
    prov:used <tabular/test.csv> ;
  ].


<http://semanticweb.org/EnergyGraph/consumption_monthly2001-2006_FINAL>
	a void:Dataset;
	prov:wasGeneratedBy [
		a setl:Transform, setl:JSLDT ;
		prov:used :table;
		setl:hasContext '''{
			"xsd" : "http://www.w3.org/2001/XMLSchema#",
			"obo" : "http://ecoinformatics.org/oboe/oboe.1.0/oboe-core.owl#",
			"hasValue" : 
				{
				 "@id": "http://ecoinformatics.org/oboe/oboe.1.0/oboe-core.owl#hasValue",
				 "@type": "xsd:decimal"
				},
			"date" :
				{
				 "@id": "http://semanticweb.org/energysources/date",
				 "@type": "xsd:gYearMonth"           
				}
		}''' ;
		prov:value '''[{
			"@id": "http://semanticweb.org/EnergyGraph/consumption_monthly2001-2006_FINAL-{{row.name}}-Observation" ,
			"@type": "obo:Observation" ,
			"obo:hasMeasurement": {"@id": "http://semanticweb.org/EnergyGraph/consumption_monthly2001-2006_FINAL-{{row.name}}-Measurement" } ,
			"obo:ofEntity": {"@id":  "http://semanticweb.org/EnergyGraph/consumption_monthly2001-2006_FINAL-{{row.name}}-ConsumptionEvent" }
		},
		{
			"@id": "http://semanticweb.org/EnergyGraph/consumption_monthly2001-2006_FINAL-{{row.name}}-Measurement" ,
			"@type": "obo:Measurement",
			"hasValue": [
			{
				"@if" : "row.ENERGY_SOURCE.lower() == 'petroleum (barrels)'" ,
				"@value": "{{42 * row.CONSUMPTION}}"
			},
			{
				"@if" : "row.ENERGY_SOURCE.lower() == 'natural gas (mcf)'" ,
				"@value":  "{{1000 * row.CONSUMPTION}}"
			},
			{
				"@if" : "row.ENERGY_SOURCE.lower() == 'coal (short tons)'" ,
				"@value":  "{{row.CONSUMPTION}}"
			}],
			"obo:usesStandard": [{
				"@if" : "row.ENERGY_SOURCE.lower() == 'petroleum (barrels)'" ,
				"@id": "obo:Gallon" 
			},
			{
				"@if" : "row.ENERGY_SOURCE.lower() == 'natural gas (mcf)'" ,
				"@id": "eg:FootCubed" 
			},
			{
				"@if" : "row.ENERGY_SOURCE.lower() == 'coal (short tons)'" ,
				"@id": "obo:Ton" 
			}]
		},
		{
			"@id": "http://semanticweb.org/EnergyGraph/consumption_monthly2001-2006_FINAL-{{row.name}}-ConsumptionEvent",
			"@type": "http://semanticweb.org/energysources/ConsumptionEvent",
			"http://semanticweb.org/energysources/date": "{{row.YEAR}}-{{row.MONTH}}"
		}]''' ;
	].


<consumption_monthly2001-2006_FINAL.ttl> a pv:File;
    dcterms:format "text/turtle";
    prov:wasGeneratedBy [
      a setl:Load;
      prov:used 
	<http://semanticweb.org/EnergyGraph/consumption_monthly2001-2006_FINAL> ;
    ].
